<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>教师个人信息-华信智原教师签课时系统</title>
    <link rel="stylesheet" type="text/css" href=".././css/normalize.css">
    <link rel="stylesheet" type="text/css" href=".././css/font/iconfont.css">
    <link rel="stylesheet" type="text/css" href=".././css/base.css">
    <link rel="stylesheet" type="text/css" href=".././css/style.css">
    <link rel="stylesheet" type="text/css" href=".././js/kalendae/kalendae.css">
    <link rel="stylesheet" type="text/css" href=".././css/newkalendae.css">
    <script type="text/javascript" src=".././js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src=".././js/kalendae/kalendae.standalone.js"></script>
    <script type="text/javascript" src=".././js/keshi.js"></script>
    <script type="text/javascript" src=".././js/jquery.cookie.js"></script>
    <script type="text/javascript" src="./../js/host.js"></script>
<!--包括IE9以及IE9以下的-->
<!--[if lte IE 9]>
  <style>
  	.select-wrap:after{
    	display:none;}
    .keshi-form select{
    padding-right:1px;}
  </style>
<![endif]-->

</head>

<body>
<header>
    <div id="header-wrap">
        <div id="header" class="header-neiye">
            <h1>华信智原教师签课时系统v1.0</h1>
        </div>
    </div>
</header>
<main id="main-wrap">
	<div id="container" class="clearfix neiye">
    	<div id="teacherInfo-wrap" class="fl">
        	<div id="teacher-clear" class="adminInfo">
                <h1>基本资料</h1>
            </div>
            <div id="teacherInfo">
            	<form name="adminInfo" method="post" action="">
               		<div class="teacher oldpwd">
                    	<input type="password" name="teacherpwd" placeholder="输入原密码" id="oldpwd">
                    </div>
                    <div class="error-tips"><span class="error-message hide" id="newpwd-message">密码必须是6到12个字符或数字</span></div>
                    <div class="teacher">
                    	<input type="password" name="teacherpwd" placeholder="输入新密码，6到12个字符或数字" id="newpwd1">
                    </div>
                    <div class="error-tips"><span class="error-message hide" id="newpwd-message1">密码必须是6到12个字符或数字</span></div>

                    <div class="teacher">
                    	<input type="password" name="teacherpwd" placeholder="确认新密码保持一致" id="newpwd2">
                    </div>
                	<div class="error-tips"><span class="error-message hide" id="newpwd-message2">两个新密码不一致</span></div>
                    <div class="teacher">
                    	<input type="submit" value="点击确认修改" class="btn-submit off" id="btn-admininfoSubmit">
                    </div>
                </form>
            </div>
            <div class="changeAllWrap hide" id="changeAllWrap">
            <div class="upload" id="upload">
                <div style="text-align: center;margin: 20px 0">
                    <h2>图片上传</h2>
                    <div class="control-group">
                        <img id="upload_img_tmp" height="200" width="320" style="margin: 20px 0">
                        <div class="col-md-9">
                            <div class="input-group">
                                <input id="upload_img" class="form-control" readonly type="text">
                                <label class="input-group-btn">
                                    <input id="file" type="file" name="file" style="left: -9999px; position: absolute;">
                                    <span style="background-color:#0f800a;padding: 2px 8px;color: white">添加图片</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="modifyImg" style="height:60px;width:300px;background-color:#334880;padding: 2px 8px;color: white;font-size: 26px">确定修改</button>
            </div>
        </div>
        </div>
        <aside class="fr">
        	<div id="slidebar" class="fr">
                <div id="teacher-info">
                    <div id="touxiang">
                        <a href="#"><img src=".././images/touxiang.jpg" id="userImg" alt="管理员头像"></a></div>
                    <div class="changeImg"><a href="javascript:;"   >修改头像</a></div>
                    <h1 class="center" id="username">汪帆</h1>
                </div>
                <nav id="teacher-menu">
                    <div id="menulist">
                        <ul>
                            <li><a href="adminIndex.html">教师信息管理</a></li>
                            <li><a href="adminSchool.html" >教务教学管理</a></li>
                            <li><a href="keshiCount.html" >课时统计管理</a></li>
                            <li><a href="adminInfo.html" class="active">管理员管理</a></li>
                             <li><a href="admindata.html">数据备份/恢复</a></li>
                              <li><a href="../index.html">退出管理系统</a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </aside>
	</div>
</main>
<footer id="footer-wrap">
	<div id="footer">
    	<p>课时系统兼容IE9+、谷歌、火狐等现代浏览器，浏览器版本过低会影响用户体验</p>
    	<p>Copyright @2018成都华信智原有限公司版权所有</p>
        <p>课时系统兼容IE8+，以及谷歌、火狐等现代浏览器</p>
        <p>设计+前端开发：赵岚稹
</p>
	<p>后端开发：汪武斌</p>
    </div>
</footer>
</body>
</html>
<script>
    //html5实现图片预览功能
    $("#file").change(function (e) {
        var file = e.target.files[0] || e.dataTransfer.files[0];
        $('#upload_img').val(document.getElementById("file").files[0].name);
        if (file) {
            var reader = new FileReader();
            reader.onload = function () {
                $("#upload_img_tmp").attr("src", this.result);
            }
            reader.readAsDataURL(file);
        }
    });


    var user = null;
    $(function(){
        if ($.cookie("user")==null || $.cookie("user") == undefined){
            alert("请先登录");
            window.location.href = ".././index.html";
            return;
        }else{
            user = JSON.parse($.cookie("user"));
            if (user.uFlag == 1){
                alert("权限不足");
                window.location.href = ".././teacher_fz.html";
                return;
            }
            console.log(user)
            $("#username").text(user.uUsername);
            $("#userImg").attr("src", host+user.uImg);
        }
    })

    //修改头像
    $("#modifyImg").click(function(){
        var user = JSON.parse($.cookie("user"));
        var formData = new FormData();
        formData.append("uId", user.uId);
        formData.append("file", document.getElementById("file").files[0]);
        $.ajax({
            url: host+"/teacher/updateImg",
            type: "POST",
            xhrFields : {
                withCredentials : true
            },
            crossDomain : true,
            data: formData,
            cache:false,
            contentType: false,
            processData: false,
            success: function (data) {
                $("#changeAllWrap").addClass("hide");
                user.uImg = data.data;
                $.cookie("user", JSON.stringify(user));
                $("#userImg").attr("src", host+user.uImg);
                console.log(data);
            },
            error: function (data) {
                console.log(data);
            }
        });
    })

    $("#btn-admininfoSubmit").click(function(){
        list = {"uId": user.uId, "oldPassword": $("#oldpwd").val(), "newPassword": $("#newpwd1").val()}

        $.ajax({
            //请求方式
            type : "PUT",
            //请求的媒体类型
            contentType: "application/json;charset=UTF-8",
            //请求地址
            url : host+"/user/updatePassword",
            xhrFields : {
                withCredentials : true
            },
            crossDomain : true,
            //数据，json字符串
            data : JSON.stringify(list),
            //请求成功
            success : function(result) {
                console.log(result);
                if (result.success){
                    alert("修改成功");
                    window.location.href = "./../index.html";
                }else{
                    alert(result.message)
                }
            },
            //请求失败，包含具体的错误信息
            error : function(e){
                console.log(e.status);
                console.log(e.responseText);
            }
        });

        return false;
    })

    $("#upload").click(function(e){
        event.stopPropagation();//阻止事件冒泡即可
    })
    $("#changeAllWrap").click(function () {
        $("#changeAllWrap").addClass("hide");
    })

</script>
